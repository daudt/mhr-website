<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Results - Mile High Runners</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <header>
        <div class="container">
            <h1>Mile High Runners</h1>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="race-results.html" class="active">Race Results</a></li>
                    <li><a href="calendar.html">Calendar</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h2>Race Results</h2>

        <div class="year-tabs">
            <button class="year-tab active" data-year="2024">2024</button>
            <button class="year-tab" data-year="2023">2023</button>
            <button class="year-tab" data-year="2019">2019</button>
            <button class="year-tab" data-year="2018">2018</button>
            <button class="year-tab" data-year="2017">2017</button>
        </div>

        <div id="results-container">
            <div class="loading">Loading race results...</div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 Mile High Runners. All rights reserved.</p>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        // Initialize race results page with most recent year
        let currentYear = 2024;

        // Year tab switching
        document.querySelectorAll('.year-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.year-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const year = tab.dataset.year;
                loadRaceResults(year);
            });
        });

        // Load initial year
        loadRaceResults(currentYear);

        async function loadRaceResults(year) {
            const container = document.getElementById('results-container');
            container.innerHTML = '<div class="loading">Loading race results...</div>';

            try {
                const response = await fetch(`data/race-results/${year}.json`);

                if (!response.ok) {
                    container.innerHTML = `<p class="no-results">No results found for ${year}</p>`;
                    return;
                }

                const races = await response.json();

                if (!races || races.length === 0) {
                    container.innerHTML = `<p class="no-results">No results found for ${year}</p>`;
                    return;
                }

                // Sort races by date (most recent first)
                races.sort((a, b) => new Date(b.date) - new Date(a.date));

                let html = '';
                races.forEach(race => {
                    const raceDate = new Date(race.date).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    html += `
                        <div class="race-section">
                            <h3>${race.event_name} – ${raceDate}</h3>
                            <ul class="results-list">
                    `;

                    race.results.forEach(result => {
                        let resultText = `${result.runner}`;
                        if (result.placement) resultText += ` – ${result.placement}`;
                        if (result.division) resultText += ` (${result.division})`;
                        if (result.time) resultText += ` – ${result.time}`;

                        html += `<li>${resultText}</li>`;
                    });

                    html += `
                            </ul>
                        </div>
                    `;
                });

                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading race results:', error);
                container.innerHTML = `<p class="error">Error loading results. Please try again later.</p>`;
            }
        }
    </script>
</body>

</html>