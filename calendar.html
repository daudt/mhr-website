<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar - Mile High Runners</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <header>
        <div class="container">
            <h1>Mile High Runners</h1>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="race-results.html">Race Results</a></li>
                    <li><a href="calendar.html" class="active">Calendar</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h2>Upcoming Workouts</h2>

        <div id="workouts-container">
            <div class="loading">Loading workouts...</div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 Mile High Runners. All rights reserved.</p>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        // Load workouts on page load
        loadWorkouts();

        async function loadWorkouts() {
            const container = document.getElementById('workouts-container');
            container.innerHTML = '<div class="loading">Loading workouts...</div>';

            try {
                const response = await fetch('data/workouts.json');

                if (!response.ok) {
                    container.innerHTML = '<p class="no-results">No upcoming workouts scheduled</p>';
                    return;
                }

                const workouts = await response.json();

                if (!workouts || workouts.length === 0) {
                    container.innerHTML = '<p class="no-results">No upcoming workouts scheduled</p>';
                    return;
                }

                // Sort workouts by date
                workouts.sort((a, b) => new Date(a.date) - new Date(b.date));

                let html = '';
                workouts.forEach(workout => {
                    const workoutDate = new Date(workout.date).toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    html += `
                        <div class="workout-card">
                            <div class="workout-header">
                                <h3>${workoutDate}, ${workout.time}</h3>
                                ${workout.location && workout.location.map_link ?
                            `<a href="${workout.location.map_link}" target="_blank" class="location-link">
                                        üìç ${workout.location.name || workout.location.address}
                                    </a>` :
                            `<p class="location">üìç ${workout.location}</p>`
                        }
                            </div>
                            <div class="workout-description">
                                ${formatWorkoutDescription(workout.description)}
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading workouts:', error);
                container.innerHTML = '<p class="error">Error loading workouts. Please try again later.</p>';
            }
        }

        function formatWorkoutDescription(description) {
            if (!description) return '';

            // Convert line breaks to <br> tags
            // Convert bullet points to <ul><li> format
            let formatted = description
                .replace(/\n/g, '<br>')
                .replace(/\* {2}/g, '<li>')
                .replace(/<br><li>/g, '<li>');

            // If we have list items, wrap in <ul>
            if (formatted.includes('<li>')) {
                formatted = '<ul>' + formatted + '</ul>';
            }

            return formatted;
        }
    </script>
</body>

</html>